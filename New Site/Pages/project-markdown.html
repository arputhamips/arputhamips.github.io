<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project Details</title>
  <link rel="stylesheet" href="/Styles/resetUtility.css">
  <link rel="stylesheet" href="/New Site/Styles/nav.css">
  <link rel="stylesheet" href="/New Site/Styles/projectpage.css">
</head>
<body>

<header>
    <nav class="nav">
      <div class="bg-blur-nav">
        <div class="width-lock">
          <h1><a href="/index.html">&lt;/NIRMAL&nbsp;<span id="ajla">AJLA</span>&gt;</a></h1>
          <button class="menu-button" id="menu-btn" onclick="ToggleNav()"><i id="btn-icon" class="fa-solid fa-bars"></i></button>
          <ul class="desktop-nav">
            <li><a href="#footer">CONTACT</a></li>
            <li><a href="#works">WORKS</a></li>
            <li><a href="#i-am">ABOUT</a></li>
          </ul>
        </div>
     </div>
      <ul class="nav-links" id="navlinks">
        <li><a id="nav-ele1" onclick="ToggleNav()" href="#">CONTACT</a></li>
        <li><a id="nav-ele2" onclick="ToggleNav()" href="#projects">WORKS</a></li>
        <li><a id="nav-ele3" onclick="ToggleNav()" href="#">ABOUT</a></li>
      </ul>
    </nav>
  </header>

<main>
  <div id="page-header">
    <h1 id="project-title"></h1>
    <p id="project-date"></p>
  </div>
  <div id="markdown-content" class="markdown-body">Loading project details...</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-container/dist/markdown-it-container.min.js"></script>
<script>
  const md = window.markdownit();
  md.use(window.markdownitContainer, 'note')
    .use(window.markdownitContainer, 'warning')
    .use(window.markdownitContainer, 'row');

  const urlParams = new URLSearchParams(window.location.search);
  const fileName = urlParams.get('file');

  function parseFrontMatter(content) {
    const match = content.match(/^---\s*\n([\s\S]+?)\n---\s*\n([\s\S]*)$/);
    if (match) {
      const metaLines = match[1].split('\n');
      const metadata = {};
      metaLines.forEach(line => {
        const [key, ...rest] = line.split(':');
        metadata[key.trim()] = rest.join(':').trim();
      });
      return { metadata, body: match[2] };
    }
    return { metadata: {}, body: content };
  }

  if (!fileName) {
    document.getElementById("markdown-content").innerText = "Error: No project file specified.";
  } else {
    fetch(`/Projects/${fileName}`)
      .then(res => res.ok ? res.text() : Promise.reject("Failed to load markdown"))
      .then(text => {
        const { metadata, body } = parseFrontMatter(text);
        document.getElementById("project-title").innerText = metadata.title || '';
        document.getElementById("project-date").innerText = metadata.date || '';
        const htmlContent = md.render(body);
        document.getElementById("markdown-content").innerHTML = htmlContent;
      })
      .catch(err => {
        document.getElementById("markdown-content").innerText = "Could not load project details.";
        console.error(err);
      });
  }
</script>

<script async src="https://kit.fontawesome.com/f32f1dfc0f.js" crossorigin="anonymous"></script>
<script src="/New Site/JS/nav.js"></script>
</body>
</html>
